# 콜스택

스택이란? 먼저 들어간 데이터가 가장 나중에 나온다. 1번, 2번, 3번 순서로 코드가 들어가면, 3번, 2번, 1번 순서로 들어간 코드가 실행된다는 것이다.

자바스크립트가 바로 이런 스택 구조를 도입되어있다. 이렇게 자바스크립트의 스택을 우리는 콜스택이라고 부른다.

자바스크립트 코드를 실행시키면, 자바스크립트에서 실행 컨텍스트를 하나 만듭니다. 이 실행 컨텍스트를 전역실행컨텍스트라고 하며, 자바스크립트의 모든 코드는 하나 이상의 전역실행컨텍스트에서 실행됩니다.

쉽게 말하면, 실행 전에 전역실행컨텍스트라는 컨테이너를 하나 만들고 그 안에서 코드가 실행된다고 볼 수 있다.

## 작업순서

- 전역실행 컨텍스트 생성
- 코드실행
- 전역실행 컨텍스트 제거
- 모든 전역실행컨텍스트 제거 시, 종료

## environment outer, environment record

## 요약

자바스크립트는 코드를 실행할 때, 콜스택 안에 실행 컨텍스트 만들어서 코드를 실행한다.
이 실행 컨텍스트 안에는 크게 record, outer 두개의 객체가 있습니다.

가장 밑에 깔리는 실행 컨텍스트를 전역 실행 컨텍스트라고 불립니다.

모든 자바스크립트 코드는 전역 실행 컨텍스트 안에서 코드가 실행됩니다.

모든 실행 컨텍스트는 record, outer 를 가지고 있습니다.

record 객체는 내부적으로, 생성과 실행이라는 두개의 스택으로 코드가 동작이 됩니다.

- 생성: 내가 실행할 코드를 전체적으로 스캔에서 변수 선언 및 함수 선언에 대한 기록을 합니다.
- 실행: 코드를 실행하고, 필요 시 선언된 변수와 함수를 업데이트를 한다.

```js
var uname = '수코딩';
console.log(uname);
```

record 객체에서는 이렇게 var로 선언한 경우에는 undefined라는 값으로 초기화까지 시켜준다.

하지만, let과 const인 경우에는 초기화를 시켜주지 않습니다.

생성단계까 끝나고 실행단계가 되었을 때, uname 값을 "수코딩"으로 변경한다.

var를 사용 시, undefined가 나오는 이유는 record객체의 생성과정에서 초기화를 해 주기 때문이다.

```js
console.log(uname);
var uname = '수코딩';
```

따라서, 이렇게 출력하는 경우에도, 이미 생성단계에서 uname을 초기화했기 때문에 없는 값이 아니라 undefined 라는 값이 있다고 출력된다.

이처럼, 생성단계에서는 변수와 함수들을 기록한다.

하지만, let, const로 선언이 되었다면 에러가 발생을 하는데, 이는 생성단계에서 조금 다른 방식으로 기록이 되기 때문이다.

let, const인 경우에는 생성단계에서 아무런 값도 넣지 않기 때문인데 ...

```js
console.log(uname);
const uname = '수코딩';
```

그래서 이렇게 출력하려고 한다면, 초기화되지 않은 값이기 때문에 에러가 발생한다. (완성되지 않은 선언이다!)

그렇다면 컨텍스트는 언제 생성?

전역컨텍스트는 무조건 우선 생성된다.

추가 컨텍스트를 만드는 경우에는 `함수가 호출 될 때` 이다.

예를들어 다음 함수를 만들고 호출한다고 가정해보자

```js
const num = 10;
function printNum() {
	console.log(num);
}
printNum();
```

전역실행컨텍스트가 하나 만들어지고,

생성 단계가 진행되는데, 이 단계에서 num이라는 변수가 선언이 되어져있다는 것을 기록한다, printNum이라는 함수는 function으로 선언되어있기 때문에 생성단계에서 온전한 코드를 다 넣어서 기록한다.

그렇기 때문에 선언 전에 호출이 가능하다.

```js
const num = 10;
printNum(); // 선언 전 호출
function printNum() {
	console.log(num);
}
```

실행 단계에서 num에 10이라는 값을 넣어둔다. (업데이트)

이제 전역컨텍스트는 printNum을 실행하기 위해서, 새로운 컨텍스트를 하나 만들어서 콜스택에 넣어둔다.

그리고 printNum을 위한 컨텍스트에서 또 생성과 실행이 진행되는데, 생성은 이미 다 되어있기 때문에 바로 실행이 진행된다.

컨텍스트가 다르면 동일 변수명이 가능하기 때문에, 함수 내에 같은 이름의 변수를 선언할 수 있다.

outer 객체는, 내가 사용하는 변수가 같은 컨텍스트에 없다면, 더 깊숙히 있는 다른 실행컨텍스트로 내려가서 해당 변수를 찾는 역할을 한다. 그래서 함수 내에서 정의되지 않은 변수도 참조해서 출력할 수 있는 것이다.

## QUESTION 그렇다면 실행 컨텍스트는 뭐야?

자바스크립트 코드가 실행될 때 필요한 환경을 제공해주는 객체
